Representation of 3-dimensional moving scene

czyli w wolnym tłumaczeniu:

Reprezentacja trójwymiarowej sceny ruchomej

Badanie geometrycznych zależności między trójwymiarową sceną a dwuwymiarowymi obrazami generowanymi poprzez ruch kamery po scenie, leży w sercu dwóch fundamentalnych typów transformacji:

1) ruch Euklidesowy == ruch brył sztywnych
2) rzut perspektywiczny

Pierwszy z nich zostanie omówiony na dzisiejszym seminarium, drugi zaś zostanie omówiony za tydzień przez Maćka. Obydwa tematy będą wymagały znajomości podstawowych obiektów i notacji z dziedziny algebry. Tak na prawdę, całe dzisiejsze seminarium, to będzie czysta algebra, ale mam nadzieję, że was tym nie zanudzę.

Agenda:
1) Świat, którym się zajmujemy (przestrzeń E^3)
2) Obiekty, które żyją w tym świecie (ruch bryły sztywnej)
3) Ruch obrotowy i jego reprezentacje
4) Reprezenatcje ruchu bryły sztywnej 
5) 

1) Niech E^3 będzie trójwymiarową przestrzenią euklidesową. Jest to naturalny sposób modelowania świata rzeczywistego. W ogólnym przypadku przestrzeń euklidesowa zdefiniowana jest poprzez 5 aksjomatów Euklidesa:
- dowolne dwa punkty można połączyć odcinkiem
- dowolny odcinek można przedłużyć nieograniczenie, uzyskując prostą
- dla danego odcinka można zaznaczyć okrąg o środku w jednym z jego końców i promieniu równym jego długości
- wszytskie kąty proste są przystające
- dwie proste, które przecinają przecią w taki sposób, że suma kątów wewnętrzych po jednej stronie jest mniejsza od dwóch kątów prostych, przetną się z tej właśnie strony

Dla naszych potrzeb, trójwymairową przestrzeń euklidesową będzie reprezentować za pomocą układu współrzędnych kartezjańskich: każdy punkt p \in E^3 może być zidentyfikowany poprzez punkt w R^3:

X = [X1, X2, X3]^T = . . \in R^3

Zamiast X1... X,Y,Z. Dzięki temu mamy zależność 1-1 między E^3 a R^3, więc bezpiecznie możemy mówić o punktach i ich współrzędnych, jakby były tym samym bytem. Przeszliśmy pierwszy krok w stronę mierzenia odległości i kątów. Czego nam brakuje, to związać E^3 z metryką. Precyzyjna definicja metryki opiera się na definicji wektora:

Def. Wektor: W przestrzeni euklidesowej, wektor v jest reprezentowany przez parę punktów p,q \in E^3 i zdefiniowany jako stzrałka skierowana łącząca p do q. Piszemy v = pq (strzałka nad).

v zapisujemy także jako [v1,v2,v3]^T \in R^3, gdzie v = Y - X.

wektor zaczeniony, wektor swobodny

zbiór wszystkich wektorów swobodnych tworzy liniową przestrzeń wektorową, z liniową kombinacją dwóch wektorów v, u \in R^3 zdefiniowaną jako:

(wzór 1)

Metryka Euklidesowa dla E^3 jes twtdy zdefiniowana poprzez produkt skalarny na przestrzeni wektorowej R^3.

(wzór 2)

Niektóre własności:

(wzór 3)
(wzór 4)

Podsumowując: przestrzeń euklidesowa E^3 może być zdefiniowana jako przestrzeń, która identyfikuje się ze zbiorem R^3 i posiada metrykę w swojej przestrzeni wektorowej daną poprzez powyższy iloczyn skalarny.

Jeszcze o wektorach: 

Def: Iloczyn wektorowy: (wzor 5)

(wzór 6)

Z tego wynika, że iloczyn wektorowy jest prostopadły do u oraz do v oraz kolejność czynników definiuje zwrot wektora wynikoego. 

Jeśli ustalimy z góry u, to iloczyn wektorowy może być reprezentowany przez funkcję z R^3 do R^3, która bierze v o zwraca u x v. Taka funkcja jest zdefiniowana jako:

(wzór 7)

Jest oczywiste, że następujący lemat zachodzi:
(wzór 8)

Dzięki czemu przestrzeń wektorowa R^3 i przestrzeń wszystkich macierzy antysymetrycznych 3x3 (so(3)) są izomorficzne.

2) Ruch bryły sztywnej

Wyobraźmy sobie obiekt ruszający się przed kamerą. Aby precyzyjnie zdefiniować jego ruch powinniśmy ustalić trajetorię każdego punktu leżącego na obiekcie. Np. specyfikując współrzędne punktu poprzez funkcję od czasu X(t). Na nasze szczęcie, nie musimy specyfikować ruchu każdego punktu. Jak za chwilę się przekonamy, do zdefiniowania ruchu obiektu wystarczy ustalić ruch jednego punktu oraz ruch trzech osi współrzędnych zaczepionych w tym punkcie. Powodem tego jest to, że dla każdej bryły sztywnej, odległość między dwoma dowolnymi punktami leżącymi na tej bryle nie zmienia się w czasie podczas ruchu tej bryły. Więc jeśli X(t) i Y(t) są współrzędnymi dowolnych dwóch punktów p i q, odległość między tymi punktami jest stała:

||X(t) - Y(t)|| == constant, for all t \in R

Ruch bryły sztywnej (lub transformacja bryły sztywnej) jest rodziną funkcji, które określają w jaki sposób współrzędne każdego punktu na bryle sztywnej się zmieniają w czasie (respektując powyższą zasadę). Zdefiniujmy taką funkcję jako:

g(t): R^3 -> R^3; X -> g(t)(X).

Zamiast patrzeć na całą ciągłą ścieżkę ruszającego się obiektu, skoncentrujemy się na funkcji między jego początkową a końcową konfiguracją (rigid-body displacement) zdefiniowaną jako:

g: R^3 -> R^3; X -> g(X).

Oprócz transformacji na współrzędnych punktu, g można również zdefiniować jako wykorzystać do transformacji na wektorach. Niech v będzie wektorem zdefiniowanym przez punkty p i q o współrzędnych v = Y - X. Wtedy, po transformacji g, otrzymujemy nowy wektor:

u = g*(v) = g(Y) - g(X)

Jako żę g zachowuje odległaści pomiędzy punktami, w oczywisty sposób otrzymujemy ||g*(v)||=||v|| dla każdego swobodnego wektora v \in R^3.

Zauważmy, że własność zachowania odległości między punktami nie jest wystarczająca aby poprawnie zdefiniować ruch bryły sztywnej. Np. taka transformacja:

f : [x,y,z]^T -> [x,y,-z]^T

Zachowuje odległość, ale nie zwrot! Aby w naszej rodzinie wykluczyć tego typu funkcje, wymagamy, aby zachowywać nie tylko odległość, ale też zwrot. Formalnie, oprócz zachowania modułu wektora, musimy także zachować produkt wektorowy.

Def Ruch bryły sztywnej (rigid-body motion). Funkcja g: R^3 -> R^3 jest ruchem bryły sztywnej wtw zachodzą:

1. ||g*(v)|| = ||v||, for all v \in R^3
2. g*(u) x g*(v) = g*(u x v), for all u,v \in R^3

Zbiór wszystkich takich ruchów nazywamy SE(3).

Nie jest do końca oczywiste, że powyższa definicja zachowuje kąty między wektorami. Ale można to udowodnić w taki sposób: iloczyn skalarny <.,.> definiujemy poprzez moduł ||.|| (polarization identity):

<u,v> = 1/4(||u+v||^2 - ||u-v||^2)

Więc skoro ||u+v|| = ||g*(u)+g*(v)||, to otzymujemy, że:

<u,v> = <g*(u),g*(v)>, for all u,v \in R^3

Innymi słowy, do definicji ruchu bryły sztywnej można dodać zachowanie iloczynu skalarnego.

W jaki sposób te własności pomagają nam precyzyjnie opisać ruch bryły sztywnej? Fakt, że odległości i zwroty są zachowane przez ruch bryły sztywnej oznacza, że punkty nie mogą ruszać się relatywnie do siebie. Konsekwencją tego faktu jest to, że ruch bryły sztywnej może być opisany przez ruch jednego wybranego punktu na bryle i rotacji układu współrzędnych wziązanego z tym punktem. Będziemy reprezentowali konfigurację bryły sztywnej związując koratezjański układ współrzędnych (frame) do jakiegoś punktu na obiekcie i będziemy śledzili ruch tego układu relytywnie do ustalonego układy współrzędnych świata. world (reference) frame.

Weźmy układ współrzędnych wyznaczony przez trzy ortonormalne wektory e1,e2,e3 \in R^3, które spełniają:

(wzor 9)

Wektory te są ułorzone tak, aby tworzyły prawoskrętny układ: e1 x e2 = e3. Ruch bryły sztywnej g daje nam:

g*(ei)^Tg*(ej) = dij, g*(e1) x g*(e2) = g*(e3).

To znacza, że wektory wynikowe g*(e1),g*(e2),g*(e3) wciąż tworzą prawoskrętny ortonormalny układ. Więc bryła sztywna zawsze może być rozpoznawana przez prawoskrętny, ortonormalny układ, który będziemy nazywali 'object coordinate frame' lub 'body coordinate frame' oraz jej ruch może być w całości opisany przez ruch takiego układu.

W szczególności powinnieśmy ustalić relację między kamerą a resztą świata. Możemy np. ustalić, że 'world frame' jest związany z obiektem kamery i reszta obiektów porusza się względem niej.

3) Ruch obrotowy i jego reprezentacje

- Reprezentacja obrotu poprzez macierze ortogonalne

Załóżmy, że mamy bryłę sztywną obracającą się wokół ustalonego punktu o \in E^3. Załóżmy, że w tym punkcie znajduje się też początek układu W będący 'world frame'em'. Zaczepimy do 'o' jeszcze jeden układ C, będący obracającą się kamerą. Relacja między tymi dwoma ukłądami współrzędnych ilustruje poniższy rysunek:

(rysynek 1)

Konfiguracja układu C względem ukłądu W jest wyznaczona przez współrzędne trzech ortonormalnych wektorów 

r1=g*(e1), r2=g*(e2), r3=g*(e3) \in R^3

r1,r2,r3 są po prostu wektorami jednostkowymi położonymi na współrzędnych x,y,z układu C. Konfiguracja obracającego się układu jest wtedy w całości wyznaczona przez macierz 3x3:

Rwc = [r1,r2,r3] \in R^3x3 

gdzie r1,r2,r3 są ułorzone kolumnami. Z tego że r1,r2,r3 tworzą układ ortonormalny mamy:

(wzor 10)

Co może by zapisane w postaci macierzy:

R_wc^TR_wc = R_wcR_wc^T = I

Każda macierz spełniająca powyższą zależność nazwya się macierzę ortogonalną. Z definicji wynika również, że:

R_wc^-1 = R_wc^T. 

Z tego że r1,r2,r3 tworzą ukłąd prawoskrętny, wymagamy aby wyznacznik macierzy R_wc był równy +1. Przestrzeń wszystkich takich ortogonalnych macierzy \in R^3x3 definiujemy jako:

SO(3)={R \in R^3x3 | R^TR = I, det(R)=+1}

Takie macierze ortogonalne tradycyjnie nazwywają się macierzami obrotu (z wiadomych powodów). (rotation matrices). Side note: SO(3) z operacją mnożenia macierzy tworzą grupę. SO(3) nazwya się czasem grupą obrotową. 

Example:

(wzor 11)

Wracajac do rysunku, każda macierz obrotu R_wc \in SO(3) reprezentuje możliwą konfigurację obiektu obruconego wokół punktu o. Ponadto taka macierz reprezentuje transformację z układu współrzędnych C do W. Konfiguracja ciągle obracającego się obiektu można opisać jako funkcja trajetorii R(t): t -> SO(3) w przestrzeni SO(3). Jeśli t=/=0, obrót pomiędzy czasem t2 i t1 opiszemy jako R(t2,t1). W prosty sposób można wywnioskować iż:

R(t2,t0) = R(t2,t1)R(t1,t0) for all t0 < t1 < t2 \in R

- Reprezentacja obrotu poprzez 'Canonical exponential coordinates' / 'Axis-angle representation'

Wg autora jest bardziej intuicyjny. Obrót jest parametryzowany poprzez dwie rzeczy:

- wektor jednostkowy wychodzący z układu
- kąt obrotu wektora (prawoskrętnie)

Wygląda obiecująco, ale czy na pewno można w ten sposób reprezentować każdy obrót bryły sztywnej? Trzeba to udowodnić. Zacznamy od początku.

Mamy trajetorię R(t): R -> SO(3) która wyznacza ciągły ruch obrotowy. Obrót musi spełniać warunek:

(wzor 12)

Oznacza to, że macierz R.(t)R^T(t) \in R^3x3 jest antysymetryczna. Czyli musi istnieć wektor w^(t) \in R^3 taki że:

R.(t)R^T(t) = w^(t) / x R(t) (z prawej)
R.(t) = w^(t)R(t)

Teraz wykorzystamy tą wiedzę do stworzenia użytecznej reprezentacji macierzy rotacyjnej. Zacznijmy od założenia, że w^ jest ustalone. W tym równaniu możemy interpretować R(t) jako macierz przejścia ( macierz, której iloczyn z wektorem stanu x, z chwili początkowej t_0, daje stan x, w późniejszej chwili t) dla następującego liniowego równania różniczkowego zwyczajnego:

x.(t) = w^x(t), x(t) \in R^3

wg autora oczywistym jest, że rozwiązaniu tego równania jest podane przez:

x(t) = e^w^t x(0)

gdzie e^w^t jest eksponentą macierzy:

(wzor 13)

zakładając że R(0)=I jest stanem początkowym rotacji otrzymujemy:

R(t) = e^w^t (to jest wazne, narysowac na tablicy)

ABy sporwidzć czy rzeczywiście e^w^t jest macierzą rotacyjną można wprost z definicji eksponenty pokazać że

(wzor 14)

Fizyczna interpretacja wzoru 13 jest taka, o której mówiliśmy na początku, czyli jeśli założymy ||w||=1 wtedy R(t)=e^w^t jest obrotem dookoła osi w \in R^3 o kąt t radianów. Ogólnie możemy t absorbować do w więc mamy R = e^w^ dla w o dowolnej długości.

Eksponenta definiuje funkcję z przestrzeni so(3) do przestrzeni SO(3), zwie się to exponential map. 

Zauważmy że otrzymaliśmy wzór 13 zakładając, że w(t) jest stały. Ale oczywiście nie zawsze tak jest. Wtedy naturalnie postaje pytanie: czy każda macierz rotacyjna R \in SO(3) może być wyrażona w formie eksponenty? Odpowiedź brzmi: tak i fakt ten pokazuje poniższe twierdzenie:

Tw. Logarithm of SO(3). Dla każdego R \in SO(3), istnieje w \ R^3 takie, że R = e^w^. 

Jest to tzw funckja z przestrzeni SO(3) do so(3). w^ = log(R)

(wzor 15)

Dzięki temu tw. możemy w efektywny sposób obliczać wektor obrotu mając daną macierz obrotu, ale w jaki sposób efektywnie obliczyć macierz obrotu R = e^w^ mając dany wektor w? Z definicji eksponenty to tak nie bardzo. Możemy użyć następującego tw:

Tw. wzór Rodrigues'a dla macierzy rotacyjnych. Mając dany w \in R^3, eksponenta macierzy R = e^w^ jest równa:

(wzor 16) caly dowod

oczywiste jest ze jest ||w||=1 i t=2kpi dostaniemy identyczność. dla każdgo k. Więc transformacja z so do SO nie jest bijekcja. bo ma nieskończenie wiele elementów w SO3.

4) Reprezentacje ruchu bryły sztywnej

Czyli ruch z rotacją oraz tranzlacją. Rysunek 3 przedstawia ruszający się obiekt z układem C do niego przypisanym. Aby opisać współrzeðne punktu p na obiekcie odnośnie do układu globalnego W, jest oczywiste że należy dodać do siebie wektor tranzlacji T_wc i wektor X_c ale opisany relatywnie do W. Z tego że X_c są współrzędnymi punktu p relatywnymi do układu C, mamy R_wcX_c, gdzie R_wc \in SO(3) jest rotacją między ukłądami W i C. Wtedy współrzędne X_w można otrzymać tak:

X_w = R_wcX_c + T_wc

Zwykle będziemy oznaczali pełny ruch bryły sztywnej przez g_wc = (R_wc,T_wc) lub po prostu g = (R,T) jeśli układy współrzędnych będą w oczywisty sposób wynikały z kontekstu. Wtedy możemy reprezentować na raz rotację i translację pomiędzy dwoma ukłądami współrzędnych. W zwięzłęj formie piszemy:

X_w = g_wc(X_c)

Zbiór wszsytkich możliwych konfiguracji bryły sztywnej może być opisany przez przestrzeń ruchów brył sztywnych:

SE(3) = {g = (R,T) | R \in SO(3), T \in R^3}

Zauważmy, że g = (R,T) nie jest jeszcze  reprezenatcją macierzową dla SE(3).Żeby tak się stało złączenie dwóch ruchów bryły sztywnej musiało by być iloczynem dwóch macierzy. Aby uzyskać taką reprezentacją musimy wprowadzić pojęcie tzw. współrzędnych jednorodnych.

- Reprezentacja jednorodna

Jak niektórzy mogli już zauważyć, w odróżnieniu od samych rotacji obiektów, transformacja pełnego ruchu bryły sztywnej nie jest liniowa, lecz afiniczna. W ramach rzypomnienia: powiemy że dwa wektory są związane liniową transformacją jeśli u = Av dla pewnej macierzy A, i są związane transformacją afiniczną jeśli u = Av + b dla pewnej macierzy A i wektora b.

Nie boimy się mimo wszystko, bo możemy dokonać konwersji z transformacji afinicznej do liniowej wykorzystując właśnie współrzędne jednorodne. Zamieniamy punkt X = [X1,X2,X3]^T \in R^3 na X- = [X1,X2,X3,1] \in R^4

W efekcie, takie rozszerzenie współrzędnych osadza przestrzeń euklidesową  E^3 w hiperpłaszczyźnie R^4 zamiast R^3. Współrzędne jednorodne wektora v = X(q) - X(p) są zdefiniowane jako różnica między jednorodbymi współrzędnymi dwóch punktów q,p stąd otrzymujemy:

(wzor 17)

Zauważmy, że wektory w powyższej formie tworzą podprzesrzeń, w której wszystkie liniowe struktury oryginalnych wektrów v \in R^3 są zachowane w niezmienionej formie prez nową reprezentację. Teraz, używając nowej notacji możemy transformację afiniczną X_w = R_wcX_c+ T_wc przepisać w postaci liniowej:

(wzor 18)

gdzie macierz g-_wc \in R^4x4 zwie się jednorodną reprezentacją ruchu brył sztywnych g_wc = (R_wc, T_wc) \in SE(3). Generalnie, jeśli g = (R,T) wtedy jego reprezentacją jednorodną jest macierz 

g-=|R T|  \in R^4x4
   |0 1|

Zauważmy, że dzięki temu możemy reprezentować transformację współrzędnych bryły sztywnej przez liniowe mnożenie macierzy. Reprezentacja jednorodna g daje nam naturalną macierzową reprezentację SE(3):

SE(3) = { g- = .. | R \in SO(3), T \in R^3} \podzbior R^4x4

Używając takie reprezentacji w łatwy sposób można sprawdzić, że SE(3) spełnia wszystkie wymagania do bycia grupą. W szczególności for all g1 g2 g \in SE(3) mamy:

...

- Reprezentacja typu exponential coordinates

5) coordinate and velocity transformations